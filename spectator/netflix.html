<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Atlas Docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Atlas Docs">
<link rel="shortcut icon" href="../images/atlas_logo_small.png">
<title>Netflix Integration Â· Atlas</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Atlas" class="md-header-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Atlas
</span>
<span class="md-header-nav__topic">
Netflix Integration
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</span>
<a href="../index.html" title="Atlas">
Atlas
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-python">Python</option></select>
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../concepts.html" class="page">Concepts</a></li>
  <li><a href="../presentations.html" class="page">Presentations</a></li>
  <li><a href="../asl/index.html" class="page">Stack Language</a>
  <ul>
    <li><a href="../asl/alerting.html" class="page">Alerting Expressions</a></li>
    <li><a href="../asl/alerting-philosophy.html" class="page">Alerting Philosophy</a></li>
    <li><a href="../asl/des.html" class="page">Double Exponential Smoothing</a></li>
  </ul></li>
  <li><a href="../asl-reference/index.html" class="page">Stack Language Reference</a>
  <ul>
    <li><a href="../asl-reference/and.html" class="page">and</a></li>
    <li><a href="../asl-reference/dist-avg.html" class="page">dist-avg</a></li>
    <li><a href="../asl-reference/eq.html" class="page">eq</a></li>
  </ul></li>
  <li><a href="../spectator/index.html" class="page">Spectator</a>
  <ul>
    <li><a href="../spectator/timers.html" class="page">Timers</a></li>
    <li><a href="../spectator/netflix.html" class="active page">Netflix Integration</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator/netflix.html#netflix-integration" class="header">Netflix Integration</a>
  <ul>
    <li><a href="../spectator/netflix.html#libraries" class="header group-java">Libraries</a></li>
    <li><a href="../spectator/netflix.html#applications" class="header group-java">Applications</a></li>
    <li><a href="../spectator/netflix.html#base-server" class="header group-java">Base Server</a></li>
    <li><a href="../spectator/netflix.html#auto-plugin" class="header group-java">Auto Plugin</a></li>
    <li><a href="../spectator/netflix.html#libraries" class="header group-python">Libraries</a></li>
    <li><a href="../spectator/netflix.html#applications" class="header group-python">Applications</a></li>
    <li><a href="../spectator/netflix.html#winston" class="header group-python">Winston</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.0*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator/netflix.html#netflix-integration" class="header">Netflix Integration</a>
  <ul>
    <li><a href="../spectator/netflix.html#libraries" class="header group-java">Libraries</a></li>
    <li><a href="../spectator/netflix.html#applications" class="header group-java">Applications</a></li>
    <li><a href="../spectator/netflix.html#base-server" class="header group-java">Base Server</a></li>
    <li><a href="../spectator/netflix.html#auto-plugin" class="header group-java">Auto Plugin</a></li>
    <li><a href="../spectator/netflix.html#libraries" class="header group-python">Libraries</a></li>
    <li><a href="../spectator/netflix.html#applications" class="header group-python">Applications</a></li>
    <li><a href="../spectator/netflix.html#winston" class="header group-python">Winston</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#netflix-integration" name="netflix-integration" class="anchor"><span class="anchor-link"></span></a>Netflix Integration</h1><div class="group-java">
<p>When running at Netflix, use the <code>atlas-client</code> library to enable transferring the instrumented data to <a href="http://github.com/Netflix/atlas/wiki/">Atlas</a>. See the appropriate section for the type of project you are working on:</p>
<ul>
  <li><a href="#libraries">Libraries</a></li>
  <li><a href="#applications">Applications</a>, specifically standalone apps using guice or governator directly.</li>
  <li><a href="#base-server">Base Server</a></li>
</ul>
<h2><a href="#libraries" name="libraries" class="anchor"><span class="anchor-link"></span></a>Libraries</h2>
<p>For libraries, the only dependency that should be needed is:</p>
<pre><code>com.netflix.spectator:spectator-api:0.62.0
</code></pre>
<p>The bindings to integrate internally should be included with the application. In your code, just inject a registry, e.g.:</p>
<pre class="prettyprint"><code class="language-java">public class Foo {
  @Inject
  public Foo(Registry registry) {
    ...
  }
  ...
}
</code></pre>
<p>See the <a href="testing.md">testing docs</a> for more information about creating a binding to use with tests.</p>
<p>Libraries should not install <code>SpectatorModule</code>. The bindings to use for the registry should be determined by the <a href="#application">application</a> that is using the library. Think of it as being like slf4j where <a href="https://www.slf4j.org/faq.html#configure_logging">logging configuration</a> is up to the end-user, not the library owner.</p>
<p>When creating a Guice module for your library, you may want to avoid binding errors if the end-user has not provided a binding for the Spectator registry. This can be done by using optional injections inside of the module, for example:</p>
<pre class="prettyprint"><code class="language-java">// Sample library class
public class MyLib {
  Registry registry;

  @Inject
  public MyLib(Registry registry) {
    this.registry = registry;
  }
}

// Guice module to configure the library and setup the bindings
public class MyLibModule extends AbstractModule {

  private static final Logger LOGGER = LoggerFactory.getLogger(MyLibModule.class);

  @Override
  protected void configure() {
  }

  @Provides
  private MyLib provideMyLib(OptionalInjections opts) {
    return new MyLib(opts.registry());
  }

  private static class OptionalInjections {
    @Inject(optional = true)
    private Registry registry;

    Registry registry() {
      if (registry == null) {
        LOGGER.warn(&quot;no spectator registry has been bound, so using noop implementation&quot;);
        registry = new NoopRegistry();
      }
      return registry;
    }
  }
}
</code></pre>
<h2><a href="#applications" name="applications" class="anchor"><span class="anchor-link"></span></a>Applications</h2>
<p>Application should include a dependency on the <code>atlas-client</code> plugin:</p>
<pre><code>netflix:atlas-client:latest.release
</code></pre>
<p>Note this is an internal only library with configs specific to the Netflix environments. It is assumed you are using Nebula so that internal maven repositories are available for your build. When configuring with governator specify the <code>AtlasModule</code>:</p>
<pre class="prettyprint"><code class="language-java">Injector injector = LifecycleInjector.builder()
    .withModules(new AtlasModule())
    .build()
    .createInjector();
</code></pre>
<p>The registry binding will then be available so it can be injected as shown in the <a href="#libraries">libraries section</a>. The insight libraries do not use any governator or guice specific features. So it is possible to use guice or other dependency injection frameworks directly with the following caveats:</p>
<ol>
  <li>However, some of the libraries do use the <a href="http://docs.oracle.com/javaee/7/api/javax/annotation/PostConstruct.html">@PostConstruct</a> and <a href="http://docs.oracle.com/javaee/7/api/javax/annotation/PreDestroy.html">@PreDestroy</a> annotations for managing lifecycle. Governator adds lifecycle management and many other features on top of guice and is the recommended way. For more minimalist support of just the lifecycle annotations on top of guice see <a href="https://github.com/Netflix/iep/tree/master/iep-guice#description">iep-guice</a>.</li>
  <li>The bindings and configuration necessary to run correctly with the internal setup are only supported as guice modules. If trying to use some other dependency injection framework, then you will be responsible for either finding a way to leverage the guice module in that framework or recreating those bindings and maintaining them as things change. It is not a paved road path.</li>
</ol>
<h2><a href="#base-server" name="base-server" class="anchor"><span class="anchor-link"></span></a>Base Server</h2>
<p>If using <code>base-server</code>, then you will get the Spectator and Atlas bindings automatically.</p>
<h2><a href="#auto-plugin" name="auto-plugin" class="anchor"><span class="anchor-link"></span></a>Auto Plugin</h2></div><div class="callout warning group-java"><div class="callout-title">Warning</div>
<p><strong>Deprecated</strong>: Use of AutoBindSingleton is generally discouraged. It is recommended to use one of the other methods.</p></div><div class="group-java">
<p>If you are only interested in getting the GC logging, there is a library with an auto-bind singleton that can be used:</p>
<pre><code>com.netflix.spectator:spectator-nflx:0.62.0
</code></pre>
<p>Assuming you are using karyon/base-server or governator with <code>com.netflix</code> in the list of base packages then the plugin should get automatically loaded.</p></div><div class="group-python">
<p>When running at Netflix, use the <code>nflx-spectator-config</code> library to enable transferring the instrumented data to <a href="http://github.com/Netflix/atlas/wiki/">Atlas</a>. See the appropriate section for the type of project you are working on:</p>
<ul>
  <li><a href="#libraries">Libraries</a></li>
  <li><a href="#applications">Applications</a></li>
  <li><a href="#winston">Winston</a></li>
</ul>
<h2><a href="#libraries" name="libraries" class="anchor"><span class="anchor-link"></span></a>Libraries</h2>
<p>Libraries should use the open source library directly and allow the application to determine how it is configured.</p>
<pre><code>pip install netflix-spectator-py
</code></pre>
<h2><a href="#applications" name="applications" class="anchor"><span class="anchor-link"></span></a>Applications</h2>
<p>Should include a dependency on <code>nflx-spectator-config</code> to get the right settings for publishing internally.</p>
<h2><a href="#winston" name="winston" class="anchor"><span class="anchor-link"></span></a>Winston</h2>
<p>If using Winston, then you will get the Spectator and Atlas bindings automatically.</p></div>
</div>
<div>
<a href="https://github.com/Netflix/atlas-docs/tree/master/src/main/paradox/spectator/netflix.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../spectator/timers.html" title="Timers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Timers
</span>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
