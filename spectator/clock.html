<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Atlas Docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Atlas Docs">
<link rel="shortcut icon" href="../images/atlas_logo_small.png">
<title>Clock Â· Atlas</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Atlas" class="md-header-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Atlas
</span>
<span class="md-header-nav__topic">
Clock
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</span>
<a href="../index.html" title="Atlas">
Atlas
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-python">Python</option></select>
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../concepts.html" class="page">Concepts</a></li>
  <li><a href="../presentations.html" class="page">Presentations</a></li>
  <li><a href="../asl/index.html" class="page">Stack Language</a>
  <ul>
    <li><a href="../asl/alerting.html" class="page">Alerting Expressions</a></li>
    <li><a href="../asl/alerting-philosophy.html" class="page">Alerting Philosophy</a></li>
    <li><a href="../asl/des.html" class="page">Double Exponential Smoothing</a></li>
  </ul></li>
  <li><a href="../asl-reference/index.html" class="page">Stack Language Reference</a>
  <ul>
    <li><a href="../asl-reference/and.html" class="page">and</a></li>
    <li><a href="../asl-reference/dist-avg.html" class="page">dist-avg</a></li>
    <li><a href="../asl-reference/eq.html" class="page">eq</a></li>
  </ul></li>
  <li><a href="../spectator/index.html" class="page">Spectator</a>
  <ul>
    <li><a href="../spectator/registry.html" class="page">Registry</a></li>
    <li><a href="../spectator/counters.html" class="page">Counters</a></li>
    <li><a href="../spectator/timers.html" class="page">Timers</a></li>
    <li><a href="../spectator/dist-summaries.html" class="page">Distribution Summaries</a></li>
    <li><a href="../spectator/gauges.html" class="page">Gauges</a></li>
    <li><a href="../spectator/clock.html" class="active page">Clock</a></li>
    <li><a href="../spectator/testing.html" class="page">Testing</a></li>
    <li><a href="../spectator/netflix.html" class="page">Netflix Integration</a></li>
    <li><a href="../spectator/conventions.html" class="page">Names</a></li>
    <li><a href="../spectator/servo.html" class="page">Servo Comparison</a></li>
  </ul></li>
  <li><a href="../spectator-ext/index.html" class="page">Spectator Extensions</a>
  <ul>
    <li><a href="../spectator-ext/jvm-buffer-pools.html" class="page">Buffer Pools</a></li>
    <li><a href="../spectator-ext/jvm-gc.html" class="page">Garbage Collection</a></li>
    <li><a href="../spectator-ext/jvm-gc-causes.html" class="page">GC Causes</a></li>
    <li><a href="../spectator-ext/jvm-memory-pools.html" class="page">Memory Pools</a></li>
    <li><a href="../spectator-ext/thread-pools.html" class="page">Thread Pools</a></li>
    <li><a href="../spectator-ext/log4j1.html" class="page">Log4j1 Appender</a></li>
    <li><a href="../spectator-ext/log4j2.html" class="page">Log4j2 Appender</a></li>
    <li><a href="../spectator-ext/placeholders.html" class="page">Placeholders</a></li>
  </ul></li>
  <li><a href="../spectator-reg/index.html" class="page">Spectator Registries</a>
  <ul>
    <li><a href="../spectator-reg/metrics3.html" class="page">Metrics3 Registry</a></li>
    <li><a href="../spectator-reg/servo.html" class="page">Servo Registry</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator/clock.html#clock" class="header">Clock</a>
  <ul>
    <li><a href="../spectator/clock.html#wall-time" class="header">Wall Time</a></li>
    <li><a href="../spectator/clock.html#monotonic-time" class="header">Monotonic Time</a></li>
    <li><a href="../spectator/clock.html#manual-clock" class="header">Manual Clock</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.0*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator/clock.html#clock" class="header">Clock</a>
  <ul>
    <li><a href="../spectator/clock.html#wall-time" class="header">Wall Time</a></li>
    <li><a href="../spectator/clock.html#monotonic-time" class="header">Monotonic Time</a></li>
    <li><a href="../spectator/clock.html#manual-clock" class="header">Manual Clock</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#clock" name="clock" class="anchor"><span class="anchor-link"></span></a>Clock</h1>
<p>When taking measurements or working with timers it is recommended to use the <a href="http://netflix.github.io/spectator/en/latest/javadoc/spectator-api/com/netflix/spectator/api/Clock.html">clock</a> interface. It provides two methods for measuring time:</p>
<h2><a href="#wall-time" name="wall-time" class="anchor"><span class="anchor-link"></span></a>Wall Time</h2>
<p>This is what most users think of for time. It can be used to get the current time like what you would see on a wall clock. In most cases when not running in tests this will call <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#currentTimeMillis--">System.currentTimeMillis()</a>.</p>
<p>Note that the values returned by this method may not be monontonically increasing. Just like a clock on your wall, this value can go back in time or jump forward at unpredictable intervals if someone sets the time. On many systems <a href="https://en.wikipedia.org/wiki/Ntpd">ntpd</a> will be constantly keeping the time synced up with an authoritative source.</p>
<p>With spectator, the clock is typically accessed via the <a href="registry.md">regstry</a>. Example of usage:</p>
<pre class="prettyprint"><code class="language-java">// Current time in milliseconds since the epoch
long currentTime = registry.clock().wallTime();
</code></pre>
<h2><a href="#monotonic-time" name="monotonic-time" class="anchor"><span class="anchor-link"></span></a>Monotonic Time</h2>
<p>While it is good in general for the wall clock to show the correct time, the unpredictable changes mean it is not a good choice for measuring how long an operation took. Consider a simple example of measuring request latency on a server:</p>
<pre class="prettyprint"><code class="language-java">long start = registry.clock().wallTime();
handleRequest(request, response);
long end = registry.clock().wallTime();
reqLatencyTimer.record(end - start, TimeUnit.MILLISECONDS);
</code></pre>
<p>If ntp fixes the server time between <code>start</code> and <code>end</code>, then the recorded latency will be wrong. Spectator will protect against obviously wrong measurements like negative latencies by dropping those values when they are recorded. However, the change could incorrectly shorten or lengthen the measured latency.</p>
<p>The clock interface also provides access to a monotonic source that is only useful for measuring elapsed time, for example:</p>
<pre class="prettyprint"><code class="language-java">long start = registry.clock().monotonicTime();
handleRequest(request, response);
long end = registry.clock().monotonicTime();
reqLatencyTimer.record(end - start, TimeUnit.NANOSECONDS);
</code></pre>
<p>In most cases this will map to <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#nanoTime--">System.nanoTime()</a>. Note the actual value returned is not meaningful unless compared with another sample to get a delta.</p>
<h2><a href="#manual-clock" name="manual-clock" class="anchor"><span class="anchor-link"></span></a>Manual Clock</h2>
<p>If timing code is written to the clock interface, then alternative implemenations can be plugged in. For test cases it is common to use <a href="http://netflix.github.io/spectator/en/latest/javadoc/spectator-api/com/netflix/spectator/api/ManualClock.html">ManualClock</a> so that tests can be reliable and fast without having to rely on hacks like sleep or assuming something will run in less than a certain amount of time. </p>
<pre class="prettyprint"><code class="language-java">ManualClock clock = new ManualClock();
Registry registry = new DefaultRegistry(clock);

Timer timer = registry.timer(&quot;test&quot;);
timer.record(() -&gt; {
  doSomething();
  clock.setMonotonicTime(42L);
});

Assert.assertEquals(timer.totalTime(), 42L);
</code></pre>
</div>
<div>
<a href="https://github.com/Netflix/atlas-docs/tree/master/src/main/paradox/spectator/clock.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../spectator/gauges.html" title="Gauges" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Gauges
</span>
</div>
</a>
<a href="../spectator/testing.html" title="Testing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Testing
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
