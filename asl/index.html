<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Atlas Docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Atlas Docs">
<link rel="shortcut icon" href="../images/atlas_logo_small.png">
<title>Stack Language · Atlas</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Atlas" class="md-header-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Atlas
</span>
<span class="md-header-nav__topic">
Stack Language
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</span>
<a href="../index.html" title="Atlas">
Atlas
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-python">Python</option></select>
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../concepts.html" class="page">Concepts</a></li>
  <li><a href="../presentations.html" class="page">Presentations</a></li>
  <li><a href="../asl/index.html" class="active page">Stack Language</a>
  <ul>
    <li><a href="../asl/alerting.html" class="page">Alerting Expressions</a></li>
    <li><a href="../asl/alerting-philosophy.html" class="page">Alerting Philosophy</a></li>
    <li><a href="../asl/des.html" class="page">Double Exponential Smoothing</a></li>
  </ul></li>
  <li><a href="../asl-reference/index.html" class="page">Stack Language Reference</a>
  <ul>
    <li><a href="../asl-reference/query/index.html" class="page">Query</a></li>
    <li><a href="../asl-reference/and.html" class="page">and</a></li>
    <li><a href="../asl-reference/dist-avg.html" class="page">dist-avg</a></li>
    <li><a href="../asl-reference/math-and.html" class="page">and</a></li>
  </ul></li>
  <li><a href="../spectator/index.html" class="page">Spectator</a>
  <ul>
    <li><a href="../spectator/timers.html" class="page">Timers</a></li>
    <li><a href="../spectator/netflix.html" class="page">Netflix Integration</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../asl/index.html#stack-language" class="header">Stack Language</a>
  <ul>
    <li><a href="../asl/index.html#parts" class="header">Parts</a></li>
    <li><a href="../asl/index.html#data-model" class="header">Data Model</a></li>
    <li><a href="../asl/index.html#simple-expressions" class="header">Simple Expressions</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.0*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../asl/index.html#stack-language" class="header">Stack Language</a>
  <ul>
    <li><a href="../asl/index.html#parts" class="header">Parts</a></li>
    <li><a href="../asl/index.html#data-model" class="header">Data Model</a></li>
    <li><a href="../asl/index.html#simple-expressions" class="header">Simple Expressions</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#stack-language" name="stack-language" class="anchor"><span class="anchor-link"></span></a>Stack Language</h1>
<p>Atlas Stack Language is designed to be a stable method of representing complex data queries in a URL-friendly format. It is loosely based on the <a href="http://oss.oetiker.ch/rrdtool/doc/rrdgraph_rpn.en.html">RPN expressions</a> supported by <a href="https://tobi.oetiker.ch/hp/">Tobias Oetiker</a>&rsquo;s <a href="http://oss.oetiker.ch/rrdtool/">rrdtool</a>. The following is an example of a stack language expression:</p>
<p><code>nf.cluster,discovery,:eq,(,nf.zone,),:by</code></p>
<p>This example pushes two strings nf.cluster and discovery onto the stack and then executes the command :eq. The equal command pops two strings from the stack and pushes a query object onto the stack. The behavior can be described by the stack effect String:key String:value – Query. We then push a list of tag keys to the stack and execute the command :by to group the results.</p>
<h2><a href="#parts" name="parts" class="anchor"><span class="anchor-link"></span></a>Parts</h2>
<p>There are only four reserved symbols used for structuring the expression: <code>,:()</code></p>
<ol>
  <li>Commas separate items on the stack. So <code>a,b</code> puts two strings on the stack with values <code>&quot;a&quot;</code>  and <code>&quot;b&quot;</code>.</li>
  <li>Colon is used to prefix operations. If the first character is a colon the item will be treated  as a command to run. For example, <code>a,:dup</code>, will push <code>&quot;a&quot;</code> on the stack and then execute the  <a href="std-dup">duplicate</a> operation.</li>
  <li>Parenthesis are used to indicate the start and end of a list. The expression <code>(,)</code> puts an  empty list on the stack. Commands inside of a list will not be executed unless the list is  passed to the <a href="std-call">call</a> command. For example, <code>(,:dup,)</code> will push a list with a single  string value of <code>&quot;:dup&quot;</code> on to the stack.</li>
</ol>
<h2><a href="#data-model" name="data-model" class="anchor"><span class="anchor-link"></span></a>Data Model</h2>
<p>The stack language is primarily used for representing expressions over tagged time series data. A tag is a string key value pair used to describe a measurement. Atlas requires at least one tag with a key of <code>name</code>. Example tags represented as a JSON map:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;name&quot;:       &quot;jvm.gc.pause&quot;,
  &quot;cause&quot;:      &quot;Allocation_Failure&quot;,
  &quot;statistic&quot;:  &quot;count&quot;,
  &quot;nf.app&quot;:     &quot;www&quot;,
  &quot;nf.cluster&quot;: &quot;www-main&quot;,
  &quot;nf.asg&quot;:     &quot;www-main-v001&quot;,
  &quot;nf.stack&quot;:   &quot;main&quot;,
  &quot;nf.node&quot;:    &quot;i-01&quot;,
  &quot;nf.region&quot;:  &quot;us-east-1&quot;,
  &quot;nf.zone&quot;:    &quot;us-east-1a&quot;
}
</code></pre>
<p>Typically tags should be dimensions that allow you to use the name as a pivot and other tags to drill down into the data. The tag keys are similar to columns in a traditional table, however, it is important to note that not all time series will have the same set of tag keys.</p>
<p>The tags are used to identify a time series, which conceptually is a set of timestamp value pairs. Here is a simplified data set shown as a table:</p>
<table>
  <thead>
    <tr>
      <th>name </th>
      <th>app </th>
      <th>node </th>
      <th>values </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>i-01 </td>
      <td>[(05:00, 33.0), (05:01, 31.0)] </td>
    </tr>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>i-02 </td>
      <td>[(05:00, 20.0), (05:01, 37.0)] </td>
    </tr>
    <tr>
      <td>cpuUsage </td>
      <td>db </td>
      <td>i-03 </td>
      <td>[(05:00, 57.0), (05:01, 62.0)] </td>
    </tr>
    <tr>
      <td>diskUsage </td>
      <td>www </td>
      <td>i-01 </td>
      <td>[(05:00, 9.0), (05:01, 9.0)] </td>
    </tr>
    <tr>
      <td>diskUsage </td>
      <td>www </td>
      <td>i-02 </td>
      <td>[(05:00, 7.0), (05:01, 8.0)] </td>
    </tr>
    <tr>
      <td>requestRate </td>
      <td>www </td>
      <td> </td>
      <td>[(05:00, 33.0), (05:01, 31.0)] </td>
    </tr>
  </tbody>
</table>
<p>The table above will be used for the examples in later sections.</p>
<h2><a href="#simple-expressions" name="simple-expressions" class="anchor"><span class="anchor-link"></span></a>Simple Expressions</h2>
<p>All expressions generally have four parts:</p>
<ol>
  <li><strong>Query:</strong> selects a set of time series.</li>
  <li><strong>Aggregation:</strong> defines how to combine the selected time series.</li>
  <li><strong>Math:</strong> manipulate the time series values or combine aggregated results with binary operations.</li>
  <li><strong>Presentation:</strong> adjust how the data is presented in a chart.</li>
</ol>
<h3><a href="#query" name="query" class="anchor"><span class="anchor-link"></span></a>Query</h3>
<p>The query is used to select a set of time series. The primary query operators are <a href="query-eq">:eq</a> and <a href="query-and">:and</a>. For a full list see the <a href="Stack-Language-Reference">query section</a> of the reference page.</p>
<p>Sample query to select all time series where the key <code>node</code> is equal to <code>i-01</code>:</p>
<pre><code>node,i-01,:eq
</code></pre>
<p>If you are familiar with SQL and assume that tag keys are column names, then this would be equivalent to:</p>
<pre><code>select * from time_series where node = &#39;i-01&#39;;
</code></pre>
<p>Using the <a href="#data-model">example data set</a> this query would return the following subset:</p>
<table>
  <thead>
    <tr>
      <th>name </th>
      <th>app </th>
      <th>node </th>
      <th>values </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>i-01 </td>
      <td>[(05:00, 33.0), (05:01, 31.0)] </td>
    </tr>
    <tr>
      <td>diskUsage </td>
      <td>www </td>
      <td>i-01 </td>
      <td>[(05:00, 9.0), (05:01, 9.0)] </td>
    </tr>
  </tbody>
</table>
<p>To get just the cpu usage for that node, use <a href="query-and">:and</a>:</p>
<pre><code>node,i-01,:eq,name,cpuUsage,:eq,:and
</code></pre>
<p>This would result in:</p>
<table>
  <thead>
    <tr>
      <th>name </th>
      <th>app </th>
      <th>node </th>
      <th>values </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>i-01 </td>
      <td>[(05:00, 33.0), (05:01, 31.0)] </td>
    </tr>
  </tbody>
</table>
<h3><a href="#aggregation" name="aggregation" class="anchor"><span class="anchor-link"></span></a>Aggregation</h3>
<p>An aggregation function maps a set of time series that matched the query to a single time series. Atlas supports four aggregate functions: <a href="data-sum">sum</a>, <a href="data-min">min</a>, <a href="data-max">max</a>, and <a href="data-count">count</a>. If no aggregate is specified on an expression, then <a href="data-sum">sum</a> will be used implicitly.</p>
<p>Using the <a href="#data-model">example data set</a>, these two expressions would be equivalent:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and
app,www,:eq,name,cpuUsage,:eq,:and,:sum
</code></pre>
<p>And would result in a single output time series:</p>
<table>
  <thead>
    <tr>
      <th>name </th>
      <th>app </th>
      <th>values </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>[(05:00, 53.0), (05:01, 68.0)] </td>
    </tr>
  </tbody>
</table>
<p>Note that the node is not present in the output. The set of tags on the output will be ones with exact matches in the query clause or explicitly listed in the <a href="#group-by">group by</a>.</p>
<p>If you wanted the max cpu for the application, then you would write:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,:max
</code></pre>
<p>What if we want the average? The <a href="data-count">count</a> aggregate is used to determine how many time series had a value for a given time. To get the average we divide the sum by the count. </p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,
:dup,
:sum,
:swap,
:count,
:div
</code></pre>
<p>There is a helper macro <a href="math-avg">:avg</a> that will do this for you, so you can write:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,:avg
</code></pre>
<h3><a href="#group-by" name="group-by" class="anchor"><span class="anchor-link"></span></a>Group By</h3>
<p>In many cases we want to group the results that were selected and return one aggregate per group. As an example suppose I want to see maximum cpu usage by application:</p>
<pre><code>name,cpuUsage,:eq,:max,(,app,),:by
</code></pre>
<p>Using the <a href="#data-model">example data set</a>, this would result in a two output time series:</p>
<table>
  <thead>
    <tr>
      <th>name </th>
      <th>app </th>
      <th>values </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cpuUsage </td>
      <td>www </td>
      <td>[(05:00, 33.0), (05:01, 37.0)] </td>
    </tr>
    <tr>
      <td>cpuUsage </td>
      <td>db </td>
      <td>[(05:00, 57.0), (05:01, 62.0)] </td>
    </tr>
  </tbody>
</table>
<h3><a href="#math" name="math" class="anchor"><span class="anchor-link"></span></a>Math</h3>
<p>Once you have a set of lines, it can be useful to manipulate them. The supported operations generally fall into two categories: unary operations to alter a single time series and binary operations that combine two time series.</p>
<p>Examples of unary operations are <a href="math-neg">negate</a> and <a href="math-abs">absolute value</a>. To apply the absolute value:</p>
<pre><code>app,web,:eq,name,cpu,:eq,:and,:sum,:abs
</code></pre>
<p>Multiple operations can be applied, for example, negating the line then applying the absolute value:</p>
<pre><code>app,web,:eq,name,cpu,:eq,:and,:sum,:neg,:abs
</code></pre>
<p>Common binary operations are <a href="math-add">add</a>, <a href="math-sub">subtract</a>, <a href="math-mul">multiply</a>, and <a href="math-div">divide</a>. The <a href="#aggregation">aggregation section</a> has an example of using divide to compute the average.</p>
<p>For a complete list see the <a href="Stack-Language-Reference">math section</a> of the reference page.</p>
<h3><a href="#presentation" name="presentation" class="anchor"><span class="anchor-link"></span></a>Presentation</h3>
<p>Once you have a final expression, you can apply presentation settings to alter how a time series is displayed in the chart. One of the most common examples is setting the label to use for the <a href="style-legend">legend</a>:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,:avg,
average cpu usage,:legend
</code></pre>
<p>You can also use tag keys as variables in the legend text, for example, setting the legend to the application:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,:avg,(,app,),:by,
$(app),:legend
</code></pre>
<p>It is also common to adjust the how the lines are shown. For example, to stack each of the lines we can use the <a href="style-stack">:stack</a> command to adjust the line style:</p>
<pre><code>app,www,:eq,name,cpuUsage,:eq,:and,:avg,(,app,),:by,
:stack,
$(app),:legend
</code></pre>
<p>For a complete list see the <a href="Stack-Language-Reference">style section</a> of the reference page.</p>
</div>
<div>
<a href="https://github.com/Netflix/atlas-docs/tree/master/src/main/paradox/asl/index.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../presentations.html" title="Presentations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Presentations
</span>
</div>
</a>
<a href="../asl/alerting.html" title="Alerting Expressions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Alerting Expressions
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
