<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Atlas Docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Atlas Docs">
<link rel="shortcut icon" href="../images/atlas_logo_small.png">
<title>Garbage Collection Â· Atlas</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Atlas" class="md-header-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Atlas
</span>
<span class="md-header-nav__topic">
Garbage Collection
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<img src="../images/atlas_logo_small.png" width="24" height="24">
</span>
<a href="../index.html" title="Atlas">
Atlas
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/Netflix/atlas-docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
Netflix/atlas-docs
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-python">Python</option></select>
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../concepts.html" class="page">Concepts</a></li>
  <li><a href="../presentations.html" class="page">Presentations</a></li>
  <li><a href="../asl/index.html" class="page">Stack Language</a>
  <ul>
    <li><a href="../asl/alerting.html" class="page">Alerting Expressions</a></li>
    <li><a href="../asl/alerting-philosophy.html" class="page">Alerting Philosophy</a></li>
    <li><a href="../asl/des.html" class="page">Double Exponential Smoothing</a></li>
  </ul></li>
  <li><a href="../asl-reference/index.html" class="page">Stack Language Reference</a>
  <ul>
    <li><a href="../asl-reference/and.html" class="page">and</a></li>
    <li><a href="../asl-reference/dist-avg.html" class="page">dist-avg</a></li>
    <li><a href="../asl-reference/eq.html" class="page">eq</a></li>
  </ul></li>
  <li><a href="../spectator/index.html" class="page">Spectator</a>
  <ul>
    <li><a href="../spectator/registry.html" class="page">Registry</a></li>
    <li><a href="../spectator/counters.html" class="page">Counters</a></li>
    <li><a href="../spectator/timers.html" class="page">Timers</a></li>
    <li><a href="../spectator/dist-summaries.html" class="page">Distribution Summaries</a></li>
    <li><a href="../spectator/gauges.html" class="page">Gauges</a></li>
    <li><a href="../spectator/clock.html" class="page">Clock</a></li>
    <li><a href="../spectator/testing.html" class="page">Testing</a></li>
    <li><a href="../spectator/netflix.html" class="page">Netflix Integration</a></li>
    <li><a href="../spectator/conventions.html" class="page">Names</a></li>
    <li><a href="../spectator/servo.html" class="page">Servo Comparison</a></li>
  </ul></li>
  <li><a href="../spectator-ext/index.html" class="page">Spectator Extensions</a>
  <ul>
    <li><a href="../spectator-ext/jvm-buffer-pools.html" class="page">Buffer Pools</a></li>
    <li><a href="../spectator-ext/jvm-gc.html" class="active page">Garbage Collection</a></li>
    <li><a href="../spectator-ext/jvm-gc-causes.html" class="page">GC Causes</a></li>
    <li><a href="../spectator-ext/jvm-memory-pools.html" class="page">Memory Pools</a></li>
    <li><a href="../spectator-ext/thread-pools.html" class="page">Thread Pools</a></li>
    <li><a href="../spectator-ext/log4j1.html" class="page">Log4j1 Appender</a></li>
    <li><a href="../spectator-ext/log4j2.html" class="page">Log4j2 Appender</a></li>
    <li><a href="../spectator-ext/placeholders.html" class="page">Placeholders</a></li>
  </ul></li>
  <li><a href="../spectator-reg/index.html" class="page">Spectator Registries</a>
  <ul>
    <li><a href="../spectator-reg/metrics3.html" class="page">Metrics3 Registry</a></li>
    <li><a href="../spectator-reg/servo.html" class="page">Servo Registry</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator-ext/jvm-gc.html#garbage-collection" class="header">Garbage Collection</a>
  <ul>
    <li><a href="../spectator-ext/jvm-gc.html#getting-started" class="header">Getting Started</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#logging" class="header">Logging</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#metrics" class="header">Metrics</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#alerting" class="header">Alerting</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.0*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../spectator-ext/jvm-gc.html#garbage-collection" class="header">Garbage Collection</a>
  <ul>
    <li><a href="../spectator-ext/jvm-gc.html#getting-started" class="header">Getting Started</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#logging" class="header">Logging</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#metrics" class="header">Metrics</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#alerting" class="header">Alerting</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#garbage-collection" name="garbage-collection" class="anchor"><span class="anchor-link"></span></a>Garbage Collection</h1>
<p>The GC module registers with the notification emitter of the <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/management/GarbageCollectorMXBean.html">GarbageCollectorMXBean</a> to provide some basic GC logging and metrics.</p>
<ul>
  <li><a href="#getting-started">Getting started</a></li>
  <li><a href="#logging">Logging</a></li>
  <li><a href="#metrics">Metrics</a></li>
  <li><a href="#alerting">Alerting</a></li>
</ul>
<h2><a href="#getting-started" name="getting-started" class="anchor"><span class="anchor-link"></span></a>Getting Started</h2>
<p>For using it internally at Netflix see the <a href="../intro/netflix.md">Netflix integration</a> guide, otherwise keep reading this section.</p>
<h3><a href="#requirements" name="requirements" class="anchor"><span class="anchor-link"></span></a>Requirements</h3>
<p>This library relies on the notification emitter added in 7u4, but there are known issues prior to 7u40. There is also a regression impacting java 9 and higher, see <a href="https://github.com/Netflix/spectator/issues/502">#502</a> and <a href="https://bugs.openjdk.java.net/browse/JDK-8196325">JDK-8196325</a> for more information. For G1 it is recommended to be on the latest version available.</p>
<h3><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h3>
<pre><code>com.netflix.spectator:spectator-ext-gc:0.62.0
</code></pre>
<h3><a href="#start-reporting" name="start-reporting" class="anchor"><span class="anchor-link"></span></a>Start Reporting</h3>
<p>Then in the initialization for the application:</p>
<pre class="prettyprint"><code class="language-java">import com.netflix.spectator.gc.GcLogger;
...
// Keep a single instance of the logger
GcLogger gc = new GcLogger();
gc.start(null);
</code></pre>
<h2><a href="#logging" name="logging" class="anchor"><span class="anchor-link"></span></a>Logging</h2>
<p>After GC events an INFO level log message will get reported using slf4j. This makes it easy to GC events in the context of other log messages for the application. The logger name is <code>com.netflix.spectator.gc.GcLogger</code> and the message will look like:</p>
<pre><code>${GC_TYPE}: ${COLLECTOR_NAME}, id=${N}, at=${START_TIME}, duration=${T}ms, cause=[${CAUSE}], ${TOTAL_USAGE_BEFORE} =&gt; ${TOTAL_USAGE_AFTER} / ${MAX_SIZE} (${PERCENT_USAGE_BEFORE} =&gt; ${PERCENT_USAGE_AFTER})
</code></pre>
<p>The id can be used to verify events were not skipped or correlate with other sources like detailed GC logs. See <a href="jvm-gc-causes.md">GC causes</a> for more details on the possible causes.</p>
<p>Sample:</p>
<pre><code>2014-08-31 02:02:24,724  INFO [com.netflix.spectator.gc.GcLogger] YOUNG: ParNew, id=5281, at=Sun Aug 31 02:02:24 UTC 2014, duration=2ms, cause=[Allocation Failure], 0.4G =&gt; 0.3G / 1.8G (24.3% =&gt; 16.6%)
</code></pre>
<h2><a href="#metrics" name="metrics" class="anchor"><span class="anchor-link"></span></a>Metrics</h2>
<h3><a href="#jvm-gc-allocationrate" name="jvm-gc-allocationrate" class="anchor"><span class="anchor-link"></span></a>jvm.gc.allocationRate</h3>
<p>The allocation rate measures how fast the application is allocating memory. It is a counter that is incremented after a GC event by the amount <code>youngGen.sizeBeforeGC</code>. Technically, right now it is:</p>
<p><code>youngGen.sizeBeforeGC - youngGen.sizeAfterGC</code></p>
<p>However, <code>youngGen.sizeAfterGC</code> should be 0 and thus the size of young gen before the GC is the amount allocated since the previous GC event.</p>
<p><strong>Unit:</strong> bytes/second</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-promotionrate" name="jvm-gc-promotionrate" class="anchor"><span class="anchor-link"></span></a>jvm.gc.promotionRate</h3>
<p>The promotion rate measures how fast data is being moved from young generation into the old generation. It is a counter that is incremented after a GC event by the amount:</p>
<p><code>abs(oldGen.sizeAfterGC - oldGen.sizeBeforeGC)</code></p>
<p><strong>Unit:</strong> bytes/second</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-livedatasize" name="jvm-gc-livedatasize" class="anchor"><span class="anchor-link"></span></a>jvm.gc.liveDataSize</h3>
<p>The live data size is the size of the old generation after a major GC. The image below shows how the live data size view compares to a metric showing the current size of the memory pool:</p>
<p><img src="../images/live_data_size.png" alt="Live Data Size" /></p>
<p><strong>Unit:</strong> bytes</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-maxdatasize" name="jvm-gc-maxdatasize" class="anchor"><span class="anchor-link"></span></a>jvm.gc.maxDataSize</h3>
<p>Maximum size for the old generation. Primary use-case is for gaining perspective on the the live data size.</p>
<p><strong>Unit:</strong> bytes</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-pause" name="jvm-gc-pause" class="anchor"><span class="anchor-link"></span></a>jvm.gc.pause</h3>
<p>Timer reporting the pause time for a GC event. All of the values reported are stop the world pauses.</p>
<p><strong>Unit:</strong></p>
<ul>
  <li><code>statistic=max</code>: seconds</li>
  <li><code>statistic=count</code>: events/second</li>
  <li><code>statistic=totalTime</code>: seconds/second</li>
</ul>
<p><strong>Dimensions:</strong></p>
<ul>
  <li><code>action</code>: action performed by the garbage collector  ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))</a>.  There is no guarantee, but the typical values seen are <code>end_of_major_GC</code> and <code>end_of_minor_GC</code>.</li>
  <li><code>cause</code>: cause that instigated GC ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))</a>.  For an explanation of common causes see the <a href="jvm-gc-causes.md">GC causes</a> page.</li>
</ul>
<h3><a href="#jvm-gc-concurrentphasetime" name="jvm-gc-concurrentphasetime" class="anchor"><span class="anchor-link"></span></a>jvm.gc.concurrentPhaseTime</h3>
<p>Timer reporting time spent in concurrent phases of CMS. pauses.</p>
<p><strong>Unit:</strong></p>
<ul>
  <li><code>statistic=max</code>: seconds</li>
  <li><code>statistic=count</code>: events/second</li>
  <li><code>statistic=totalTime</code>: seconds/second</li>
</ul>
<p><strong>Dimensions:</strong></p>
<ul>
  <li><code>action</code>: action performed by the garbage collector  ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))</a>.  There is no guarantee, but the typical values seen are <code>end_of_major_GC</code> and <code>end_of_minor_GC</code>.</li>
  <li><code>cause</code>: cause that instigated GC ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))</a>.  For an explanation of common causes see the <a href="jvm-gc-causes.md">GC causes</a> page.</li>
</ul>
<h2><a href="#alerting" name="alerting" class="anchor"><span class="anchor-link"></span></a>Alerting</h2>
<p>This section assumes the data is available in <a href="https://github.com/Netflix/atlas/wiki/">Atlas</a>, but users of other systems should be able to take the idea and make it work. For all of these alerts it is recommended to check them on instance. At Netflix that can be done by selecting the option in alert ui:</p>
<blockquote>
  <p><img src="../images/on_instance.png" alt="On Instance Alerting" /></p>
</blockquote>
<h3><a href="#max-pause-time" name="max-pause-time" class="anchor"><span class="anchor-link"></span></a>Max Pause Time</h3>
<p>Example to trigger an alert if the <a href="#jvmgcpause">pause time</a> exceeds 500 milliseconds:</p>
<pre><code>name,jvm.gc.pause,:eq,
statistic,max,:eq,
:and,
:max,(,cause,),:by,
0.5,:gt,
$cause,:legend
</code></pre>
<h3><a href="#heap-pressure" name="heap-pressure" class="anchor"><span class="anchor-link"></span></a>Heap Pressure</h3>
<p>Example to trigger an alert if the <a href="#jvmgclivedatasize">live data size</a> is over 70% of the heap:</p>
<pre><code>name,jvm.gc.liveDataSize,:eq,:max,
name,jvm.gc.maxDataSize,:eq,:max,
:div,100,:mul,
70,:gt,
percentUsed,:legend
</code></pre>
</div>
<div>
<a href="https://github.com/Netflix/atlas-docs/tree/master/src/main/paradox/spectator-ext/jvm-gc.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../spectator-ext/jvm-buffer-pools.html" title="Buffer Pools" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Buffer Pools
</span>
</div>
</a>
<a href="../spectator-ext/jvm-gc-causes.html" title="GC Causes" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
GC Causes
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
