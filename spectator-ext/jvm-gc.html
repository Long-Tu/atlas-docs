<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet"
href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
crossorigin="anonymous">
<link rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0="
crossorigin="anonymous">
<link rel="stylesheet" href="../css/page.css">

<title>Atlas</title>
</head>
<body>
<header class="navbar navbar-expand-lg navbar-dark" id="nav-top">
<a class="navbar-brand" href="../index.html">
<img src="../images/atlas_logo_small.png" width="40px" height="40px"/>
</a>
<ul class="navbar-nav mr-auto">
<li class="nav-item active">
<a class="nav-link" href="../index.html">
<span style="font-size: 1.8em;">Atlas</span>
</a>
</li>
</ul>

<button type="button" class="btn btn-outline-light" data-toggle="modal" data-target="#search-modal">
<span class="fa fa-search"></span>
</button>
</header>

<div id="search-modal" class="modal" tabindex="-1" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<form style="min-width: 100%">
<input class="form-control form-control-sm" id="search" type="text" autocomplete="off">
</form>
</div>
<div class="modal-body">
<div id="search-results"></div>
</div>
</div>
</div>
</div>

<div class="container-fluid">
<div class="row flex-xl-nowrap justify-content-md-center">
<div class="d-none d-lg-block col-lg-2 col-xl-2" id="nav-left">
<select class="supergroup" name="Language"><option class="group" value="group-java">Java</option><option class="group" value="group-python">Python</option></select>
<ul>
  <li><a href="../overview.html" class="page">Overview</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../concepts.html" class="page">Concepts</a></li>
  <li><a href="../presentations.html" class="page">Presentations</a></li>
  <li><a href="../asl/index.html" class="page">Stack Language</a>
  <ul>
    <li><a href="../asl/alerting.html" class="page">Alerting Expressions</a></li>
    <li><a href="../asl/alerting-philosophy.html" class="page">Alerting Philosophy</a></li>
    <li><a href="../asl/des.html" class="page">Double Exponential Smoothing</a></li>
  </ul></li>
  <li><a href="../asl-reference/index.html" class="page">Stack Language Reference</a>
  <ul>
    <li><a href="../asl-reference/2over.html" class="page">2over</a></li>
    <li><a href="../asl-reference/-rot.html" class="page">-rot</a></li>
    <li><a href="../asl-reference/and.html" class="page">and</a></li>
    <li><a href="../asl-reference/call.html" class="page">call</a></li>
    <li><a href="../asl-reference/clear.html" class="page">clear</a></li>
    <li><a href="../asl-reference/cq.html" class="page">cq</a></li>
    <li><a href="../asl-reference/des.html" class="page">des</a></li>
    <li><a href="../asl-reference/des-epic-signal.html" class="page">des-epic-signal</a></li>
    <li><a href="../asl-reference/des-epic-viz.html" class="page">des-epic-viz</a></li>
    <li><a href="../asl-reference/des-fast.html" class="page">des-fast</a></li>
    <li><a href="../asl-reference/des-slow.html" class="page">des-slow</a></li>
    <li><a href="../asl-reference/des-slower.html" class="page">des-slower</a></li>
    <li><a href="../asl-reference/dist-avg.html" class="page">dist-avg</a></li>
    <li><a href="../asl-reference/drop.html" class="page">drop</a></li>
    <li><a href="../asl-reference/dup.html" class="page">dup</a></li>
    <li><a href="../asl-reference/each.html" class="page">each</a></li>
    <li><a href="../asl-reference/eq.html" class="page">eq</a></li>
    <li><a href="../asl-reference/fcall.html" class="page">fcall</a></li>
    <li><a href="../asl-reference/format.html" class="page">format</a></li>
    <li><a href="../asl-reference/freeze.html" class="page">freeze</a></li>
    <li><a href="../asl-reference/get.html" class="page">get</a></li>
    <li><a href="../asl-reference/list.html" class="page">list</a></li>
    <li><a href="../asl-reference/map.html" class="page">map</a></li>
    <li><a href="../asl-reference/ndrop.html" class="page">ndrop</a></li>
    <li><a href="../asl-reference/nip.html" class="page">nip</a></li>
    <li><a href="../asl-reference/nlist.html" class="page">nlist</a></li>
    <li><a href="../asl-reference/over.html" class="page">over</a></li>
    <li><a href="../asl-reference/pick.html" class="page">pick</a></li>
    <li><a href="../asl-reference/random.html" class="page">random</a></li>
    <li><a href="../asl-reference/roll.html" class="page">roll</a></li>
    <li><a href="../asl-reference/rot.html" class="page">rot</a></li>
    <li><a href="../asl-reference/sdes.html" class="page">sdes</a></li>
    <li><a href="../asl-reference/sdes-fast.html" class="page">sdes-fast</a></li>
    <li><a href="../asl-reference/sdes-slow.html" class="page">sdes-slow</a></li>
    <li><a href="../asl-reference/sdes-slower.html" class="page">sdes-slower</a></li>
    <li><a href="../asl-reference/set.html" class="page">set</a></li>
    <li><a href="../asl-reference/srandom.html" class="page">srandom</a></li>
    <li><a href="../asl-reference/sset.html" class="page">sset</a></li>
    <li><a href="../asl-reference/swap.html" class="page">swap</a></li>
    <li><a href="../asl-reference/tuck.html" class="page">tuck</a></li>
  </ul></li>
  <li><a href="../spectator/index.html" class="page">Spectator</a>
  <ul>
    <li><a href="../spectator/registry.html" class="page">Registry</a></li>
    <li><a href="../spectator/counters.html" class="page">Counters</a></li>
    <li><a href="../spectator/timers.html" class="page">Timers</a></li>
    <li><a href="../spectator/dist-summaries.html" class="page">Distribution Summaries</a></li>
    <li><a href="../spectator/gauges.html" class="page">Gauges</a></li>
    <li><a href="../spectator/clock.html" class="page">Clock</a></li>
    <li><a href="../spectator/testing.html" class="page">Testing</a></li>
    <li><a href="../spectator/netflix.html" class="page">Netflix Integration</a></li>
    <li><a href="../spectator/conventions.html" class="page">Names</a></li>
    <li><a href="../spectator/servo.html" class="page">Servo Comparison</a></li>
  </ul></li>
  <li><a href="../spectator-ext/index.html" class="page">Spectator Extensions</a>
  <ul>
    <li><a href="../spectator-ext/jvm-buffer-pools.html" class="page">Buffer Pools</a></li>
    <li><a href="../spectator-ext/jvm-gc.html" class="active page">Garbage Collection</a></li>
    <li><a href="../spectator-ext/jvm-gc-causes.html" class="page">GC Causes</a></li>
    <li><a href="../spectator-ext/jvm-memory-pools.html" class="page">Memory Pools</a></li>
    <li><a href="../spectator-ext/thread-pools.html" class="page">Thread Pools</a></li>
    <li><a href="../spectator-ext/log4j1.html" class="page">Log4j1 Appender</a></li>
    <li><a href="../spectator-ext/log4j2.html" class="page">Log4j2 Appender</a></li>
    <li><a href="../spectator-ext/placeholders.html" class="page">Placeholders</a></li>
  </ul></li>
  <li><a href="../spectator-reg/index.html" class="page">Spectator Registries</a>
  <ul>
    <li><a href="../spectator-reg/metrics3.html" class="page">Metrics3 Registry</a></li>
    <li><a href="../spectator-reg/servo.html" class="page">Servo Registry</a></li>
  </ul></li>
</ul>
</div>
<div class="col-12 col-md-9 col-xl-8 py-md-3" id="content">
<h1><a href="#garbage-collection" name="garbage-collection" class="anchor"><span class="anchor-link"></span></a>Garbage Collection</h1>
<p>The GC module registers with the notification emitter of the <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/management/GarbageCollectorMXBean.html">GarbageCollectorMXBean</a> to provide some basic GC logging and metrics.</p>
<ul>
  <li><a href="#getting-started">Getting started</a></li>
  <li><a href="#logging">Logging</a></li>
  <li><a href="#metrics">Metrics</a></li>
  <li><a href="#alerting">Alerting</a></li>
</ul>
<h2><a href="#getting-started" name="getting-started" class="anchor"><span class="anchor-link"></span></a>Getting Started</h2>
<p>For using it internally at Netflix see the <a href="../intro/netflix.md">Netflix integration</a> guide, otherwise keep reading this section.</p>
<h3><a href="#requirements" name="requirements" class="anchor"><span class="anchor-link"></span></a>Requirements</h3>
<p>This library relies on the notification emitter added in 7u4, but there are known issues prior to 7u40. There is also a regression impacting java 9 and higher, see <a href="https://github.com/Netflix/spectator/issues/502">#502</a> and <a href="https://bugs.openjdk.java.net/browse/JDK-8196325">JDK-8196325</a> for more information. For G1 it is recommended to be on the latest version available.</p>
<h3><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h3>
<pre><code>com.netflix.spectator:spectator-ext-gc:0.62.0
</code></pre>
<h3><a href="#start-reporting" name="start-reporting" class="anchor"><span class="anchor-link"></span></a>Start Reporting</h3>
<p>Then in the initialization for the application:</p>
<pre class="prettyprint"><code class="language-java">import com.netflix.spectator.gc.GcLogger;
...
// Keep a single instance of the logger
GcLogger gc = new GcLogger();
gc.start(null);
</code></pre>
<h2><a href="#logging" name="logging" class="anchor"><span class="anchor-link"></span></a>Logging</h2>
<p>After GC events an INFO level log message will get reported using slf4j. This makes it easy to GC events in the context of other log messages for the application. The logger name is <code>com.netflix.spectator.gc.GcLogger</code> and the message will look like:</p>
<pre><code>${GC_TYPE}: ${COLLECTOR_NAME}, id=${N}, at=${START_TIME}, duration=${T}ms, cause=[${CAUSE}], ${TOTAL_USAGE_BEFORE} =&gt; ${TOTAL_USAGE_AFTER} / ${MAX_SIZE} (${PERCENT_USAGE_BEFORE} =&gt; ${PERCENT_USAGE_AFTER})
</code></pre>
<p>The id can be used to verify events were not skipped or correlate with other sources like detailed GC logs. See <a href="jvm-gc-causes.md">GC causes</a> for more details on the possible causes.</p>
<p>Sample:</p>
<pre><code>2014-08-31 02:02:24,724  INFO [com.netflix.spectator.gc.GcLogger] YOUNG: ParNew, id=5281, at=Sun Aug 31 02:02:24 UTC 2014, duration=2ms, cause=[Allocation Failure], 0.4G =&gt; 0.3G / 1.8G (24.3% =&gt; 16.6%)
</code></pre>
<h2><a href="#metrics" name="metrics" class="anchor"><span class="anchor-link"></span></a>Metrics</h2>
<h3><a href="#jvm-gc-allocationrate" name="jvm-gc-allocationrate" class="anchor"><span class="anchor-link"></span></a>jvm.gc.allocationRate</h3>
<p>The allocation rate measures how fast the application is allocating memory. It is a counter that is incremented after a GC event by the amount <code>youngGen.sizeBeforeGC</code>. Technically, right now it is:</p>
<p><code>youngGen.sizeBeforeGC - youngGen.sizeAfterGC</code></p>
<p>However, <code>youngGen.sizeAfterGC</code> should be 0 and thus the size of young gen before the GC is the amount allocated since the previous GC event.</p>
<p><strong>Unit:</strong> bytes/second</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-promotionrate" name="jvm-gc-promotionrate" class="anchor"><span class="anchor-link"></span></a>jvm.gc.promotionRate</h3>
<p>The promotion rate measures how fast data is being moved from young generation into the old generation. It is a counter that is incremented after a GC event by the amount:</p>
<p><code>abs(oldGen.sizeAfterGC - oldGen.sizeBeforeGC)</code></p>
<p><strong>Unit:</strong> bytes/second</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-livedatasize" name="jvm-gc-livedatasize" class="anchor"><span class="anchor-link"></span></a>jvm.gc.liveDataSize</h3>
<p>The live data size is the size of the old generation after a major GC. The image below shows how the live data size view compares to a metric showing the current size of the memory pool:</p>
<p><img src="../images/live_data_size.png" alt="Live Data Size" /></p>
<p><strong>Unit:</strong> bytes</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-maxdatasize" name="jvm-gc-maxdatasize" class="anchor"><span class="anchor-link"></span></a>jvm.gc.maxDataSize</h3>
<p>Maximum size for the old generation. Primary use-case is for gaining perspective on the the live data size.</p>
<p><strong>Unit:</strong> bytes</p>
<p><strong>Dimensions:</strong> n/a</p>
<h3><a href="#jvm-gc-pause" name="jvm-gc-pause" class="anchor"><span class="anchor-link"></span></a>jvm.gc.pause</h3>
<p>Timer reporting the pause time for a GC event. All of the values reported are stop the world pauses.</p>
<p><strong>Unit:</strong></p>
<ul>
  <li><code>statistic=max</code>: seconds</li>
  <li><code>statistic=count</code>: events/second</li>
  <li><code>statistic=totalTime</code>: seconds/second</li>
</ul>
<p><strong>Dimensions:</strong></p>
<ul>
  <li><code>action</code>: action performed by the garbage collector  ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))</a>.  There is no guarantee, but the typical values seen are <code>end_of_major_GC</code> and <code>end_of_minor_GC</code>.</li>
  <li><code>cause</code>: cause that instigated GC ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))</a>.  For an explanation of common causes see the <a href="jvm-gc-causes.md">GC causes</a> page.</li>
</ul>
<h3><a href="#jvm-gc-concurrentphasetime" name="jvm-gc-concurrentphasetime" class="anchor"><span class="anchor-link"></span></a>jvm.gc.concurrentPhaseTime</h3>
<p>Timer reporting time spent in concurrent phases of CMS. pauses.</p>
<p><strong>Unit:</strong></p>
<ul>
  <li><code>statistic=max</code>: seconds</li>
  <li><code>statistic=count</code>: events/second</li>
  <li><code>statistic=totalTime</code>: seconds/second</li>
</ul>
<p><strong>Dimensions:</strong></p>
<ul>
  <li><code>action</code>: action performed by the garbage collector  ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcAction()))</a>.  There is no guarantee, but the typical values seen are <code>end_of_major_GC</code> and <code>end_of_minor_GC</code>.</li>
  <li><code>cause</code>: cause that instigated GC ([javadoc](<a href="http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))">http://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/GarbageCollectionNotificationInfo.html#getGcCause()))</a>.  For an explanation of common causes see the <a href="jvm-gc-causes.md">GC causes</a> page.</li>
</ul>
<h2><a href="#alerting" name="alerting" class="anchor"><span class="anchor-link"></span></a>Alerting</h2>
<p>This section assumes the data is available in <a href="https://github.com/Netflix/atlas/wiki/">Atlas</a>, but users of other systems should be able to take the idea and make it work. For all of these alerts it is recommended to check them on instance. At Netflix that can be done by selecting the option in alert ui:</p>
<blockquote>
  <p><img src="../images/on_instance.png" alt="On Instance Alerting" /></p>
</blockquote>
<h3><a href="#max-pause-time" name="max-pause-time" class="anchor"><span class="anchor-link"></span></a>Max Pause Time</h3>
<p>Example to trigger an alert if the <a href="#jvmgcpause">pause time</a> exceeds 500 milliseconds:</p>
<pre><code>name,jvm.gc.pause,:eq,
statistic,max,:eq,
:and,
:max,(,cause,),:by,
0.5,:gt,
$cause,:legend
</code></pre>
<h3><a href="#heap-pressure" name="heap-pressure" class="anchor"><span class="anchor-link"></span></a>Heap Pressure</h3>
<p>Example to trigger an alert if the <a href="#jvmgclivedatasize">live data size</a> is over 70% of the heap:</p>
<pre><code>name,jvm.gc.liveDataSize,:eq,:max,
name,jvm.gc.maxDataSize,:eq,:max,
:div,100,:mul,
70,:gt,
percentUsed,:legend
</code></pre>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../spectator-ext/jvm-gc-causes.html">GC Causes</a></p>
</div>
</div>
<div class="d-none d-xl-block col-xl-2" id="nav-right">
<ul>
  <li><a href="../spectator-ext/jvm-gc.html#garbage-collection" class="header">Garbage Collection</a>
  <ul>
    <li><a href="../spectator-ext/jvm-gc.html#getting-started" class="header">Getting Started</a>
    <ul>
      <li><a href="../spectator-ext/jvm-gc.html#requirements" class="header">Requirements</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#dependencies" class="header">Dependencies</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#start-reporting" class="header">Start Reporting</a></li>
    </ul></li>
    <li><a href="../spectator-ext/jvm-gc.html#logging" class="header">Logging</a></li>
    <li><a href="../spectator-ext/jvm-gc.html#metrics" class="header">Metrics</a>
    <ul>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-allocationrate" class="header">jvm.gc.allocationRate</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-promotionrate" class="header">jvm.gc.promotionRate</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-livedatasize" class="header">jvm.gc.liveDataSize</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-maxdatasize" class="header">jvm.gc.maxDataSize</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-pause" class="header">jvm.gc.pause</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#jvm-gc-concurrentphasetime" class="header">jvm.gc.concurrentPhaseTime</a></li>
    </ul></li>
    <li><a href="../spectator-ext/jvm-gc.html#alerting" class="header">Alerting</a>
    <ul>
      <li><a href="../spectator-ext/jvm-gc.html#max-pause-time" class="header">Max Pause Time</a></li>
      <li><a href="../spectator-ext/jvm-gc.html#heap-pressure" class="header">Heap Pressure</a></li>
    </ul></li>
  </ul></li>
</ul>
</div>
</div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/lunr@2.1.6/lunr.js"
integrity="sha256-U3smMZ6uKxtHEAX38FWHzhjlVgfcm5Xvs0Gp8t3unQk="
crossorigin="anonymous"></script>
<script src="../js/page.js"></script>
<script>initialize("../")</script>

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=scala"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
</body>
</html>
